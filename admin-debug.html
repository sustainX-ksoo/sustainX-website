<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sustainX - ê´€ë¦¬ì ë””ë²„ê¹… í˜ì´ì§€</title>
    <link rel="stylesheet" href="./dist/output.css">
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-blue-600">ğŸ”§ sustainX ê´€ë¦¬ì ë””ë²„ê¹… í˜ì´ì§€</h1>
        
        <!-- ìƒíƒœ í‘œì‹œ -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ” í˜„ì¬ ìƒíƒœ</h2>
            <div id="status" class="space-y-2 text-sm font-mono"></div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ§ª í…ŒìŠ¤íŠ¸ ë„êµ¬</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="checkStatus()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ìƒíƒœ í™•ì¸
                </button>
                <button onclick="checkFirebase()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Firebase í™•ì¸
                </button>
                <button onclick="checkAuth()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ì¸ì¦ í™•ì¸
                </button>
                <button onclick="goToAdmin()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    ê´€ë¦¬ì í˜ì´ì§€ë¡œ
                </button>
            </div>
        </div>
        
        <!-- ë¡œê·¸ -->
        <div class="bg-gray-900 text-green-400 p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4 text-white">ğŸ“ ë¡œê·¸</h2>
            <div id="log" class="text-sm font-mono h-96 overflow-y-auto"></div>
        </div>
    </div>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const colors = {
                info: 'text-green-400',
                error: 'text-red-400',
                warn: 'text-yellow-400',
                success: 'text-blue-400'
            };
            logEl.innerHTML += `<div class="${colors[type]}">[${time}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(message);
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateStatus() {
            const statusEl = document.getElementById('status');
            statusEl.innerHTML = `
                <div><strong>í˜„ì¬ URL:</strong> ${window.location.href}</div>
                <div><strong>ì´ì „ í˜ì´ì§€:</strong> ${document.referrer}</div>
                <div><strong>Firebase Auth:</strong> ${window.auth ? 'âœ… ë¡œë“œë¨' : 'âŒ ë¡œë“œ ì•ˆë¨'}</div>
                <div><strong>Firebase DB:</strong> ${window.db ? 'âœ… ë¡œë“œë¨' : 'âŒ ë¡œë“œ ì•ˆë¨'}</div>
                <div><strong>Current User:</strong> ${window.auth?.currentUser?.email || 'âŒ ì—†ìŒ'}</div>
                <div><strong>ì„¸ì…˜ ë¡œê·¸ì¸:</strong> ${sessionStorage.getItem('sustainx_admin_logged_in') || 'âŒ ì—†ìŒ'}</div>
                <div><strong>ì„¸ì…˜ ì´ë©”ì¼:</strong> ${sessionStorage.getItem('sustainx_admin_email') || 'âŒ ì—†ìŒ'}</div>
            `;
        }

        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function checkStatus() {
            log('ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            updateStatus();
            log('ìƒíƒœ í™•ì¸ ì™„ë£Œ', 'success');
        }

        function checkFirebase() {
            log('Firebase ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            
            if (!window.auth) {
                log('âŒ Firebase Authê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ', 'error');
                return;
            }
            
            if (!window.db) {
                log('âŒ Firebase Firestoreê°€ ë¡œë“œë˜ì§€ ì•ŠìŒ', 'error');
                return;
            }
            
            log('âœ… Firebase ëª¨ë“  ì„œë¹„ìŠ¤ ì •ìƒ ë¡œë“œë¨', 'success');
            
            // í˜„ì¬ ì‚¬ìš©ì í™•ì¸
            if (auth.currentUser) {
                log(`âœ… í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì: ${auth.currentUser.email}`, 'success');
            } else {
                log('âŒ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì—†ìŒ', 'warn');
            }
        }

        async function checkAuth() {
            log('ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            
            return new Promise((resolve) => {
                if (!auth) {
                    log('âŒ Firebase Authê°€ ì—†ìŒ', 'error');
                    resolve(false);
                    return;
                }

                // í˜„ì¬ ì‚¬ìš©ì ì¦‰ì‹œ í™•ì¸
                if (auth.currentUser) {
                    log(`âœ… ì´ë¯¸ ì¸ì¦ëœ ì‚¬ìš©ì: ${auth.currentUser.email}`, 'success');
                    resolve(true);
                    return;
                }

                log('Auth ìƒíƒœ ë³€í™” ë¦¬ìŠ¤ë„ˆ ë“±ë¡...', 'info');
                
                // Auth ìƒíƒœ ë³€í™” ë¦¬ìŠ¤ë„ˆ
                const unsubscribe = auth.onAuthStateChanged((user) => {
                    if (user) {
                        log(`âœ… ì¸ì¦ ì„±ê³µ: ${user.email}`, 'success');
                        resolve(true);
                    } else {
                        log('âŒ ì¸ì¦ë˜ì§€ ì•ŠìŒ', 'error');
                        resolve(false);
                    }
                    unsubscribe();
                });

                // 3ì´ˆ íƒ€ì„ì•„ì›ƒ
                setTimeout(() => {
                    log('â° ì¸ì¦ ì²´í¬ íƒ€ì„ì•„ì›ƒ', 'warn');
                    unsubscribe();
                    resolve(false);
                }, 3000);
            });
        }

        function goToAdmin() {
            log('ê´€ë¦¬ì í˜ì´ì§€ë¡œ ì´ë™...', 'info');
            window.location.href = 'admin.html';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ ë””ë²„ê¹… í˜ì´ì§€ ë¡œë“œë¨', 'success');
            
            // Firebase ë¡œë“œ ëŒ€ê¸°
            let attempts = 0;
            const waitForFirebase = () => {
                attempts++;
                if (window.auth && window.db) {
                    log('âœ… Firebase ì´ˆê¸°í™” ì™„ë£Œ', 'success');
                    updateStatus();
                    
                    // ìë™ìœ¼ë¡œ ì¸ì¦ ì²´í¬
                    setTimeout(() => {
                        log('ìë™ ì¸ì¦ ì²´í¬ ì‹œì‘...', 'info');
                        checkAuth();
                    }, 1000);
                } else if (attempts < 50) {
                    setTimeout(waitForFirebase, 100);
                } else {
                    log('âŒ Firebase ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ', 'error');
                    updateStatus();
                }
            };
            
            waitForFirebase();
        });

        // 5ì´ˆë§ˆë‹¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>